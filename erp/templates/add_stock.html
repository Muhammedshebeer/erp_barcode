{% extends 'base.html' %}
{% block content %}
<h3>Add Stock</h3>
<form method="post">{% csrf_token %}
  <div class="mb-3">
      <label>Product</label>
<input type="text" id="product-search" class="form-control" placeholder="Search by name or SKU">
<input type="hidden" name="product_id" id="product-id">

<ul id="product-results" class="list-group mt-1" style="max-height:200px; overflow-y:auto;"></ul>

  </div>


{{ form.qty.label_tag }} {{ form.qty }}
{{ form.purchase_price.label_tag }} {{ form.purchase_price }}
{{ form.supplier.label_tag }} {{ form.supplier }}
{{ form.remarks.label_tag }} {{ form.remarks }}
  <button class="btn btn-primary">Save Stock Entry</button>
</form>
{% endblock %}

{% block scripts %}
<script>
const searchInput = document.getElementById("product-search");
const resultsList = document.getElementById("product-results");
const hiddenInput = document.getElementById("product-id");

searchInput.addEventListener("input", function () {
    const q = this.value;

    if (!q.trim()) {
        resultsList.innerHTML = "";
        return;
    }

    fetch(`/ajax/product-search/?q=${encodeURIComponent(q)}`)
        .then(res => res.json())
        .then(data => {
            resultsList.innerHTML = "";

            data.results.forEach(item => {
                const li = document.createElement("li");
                li.classList.add("list-group-item");
                li.style.cursor = "pointer";
                li.textContent = item.text;

                li.onclick = () => {
                    searchInput.value = item.text;
                    hiddenInput.value = item.id;
                    resultsList.innerHTML = "";
                };

                resultsList.appendChild(li);
            });
        });
});
</script>
{% endblock %}
